language: cpp
matrix:
  include:
  - os: linux
    env:
    - TARGET_ARCHITECTURE=x86_64
    - TRAVIS_NODE_VERSION="6"
    compiler:
    - gcc
    install:
    - rm -rf ~/.nvm && git clone https://github.com/creationix/nvm.git ~/.nvm && (cd
      ~/.nvm && git checkout `git describe --abbrev=0 --tags`) && source ~/.nvm/nvm.sh
      && nvm install $TRAVIS_NODE_VERSION
    addons:
      apt:
        packages:
        - cmake
        - libsqlite3-dev
        - curl
        - libcurl4-openssl-dev
        - libssl-dev
        - libavahi-client-dev
    script:
    - cmake -DDEBUG=OFF . && make && cd www && npm install && npm run build_prod &&
      cd ..
  - os: osx
    env:
    - TARGET_ARCHITECTURE=x86_64
    - TRAVIS_NODE_VERSION="6"
    compiler:
    - gcc
    install:
    - brew update
    - brew install libusb
    - brew install libusb-compat
    - brew install openssl
    - export OPENSSL_ROOT_DIR=/usr/local/opt/openssl
    - rm -rf ~/.nvm && git clone https://github.com/creationix/nvm.git ~/.nvm && (cd
      ~/.nvm && git checkout `git describe --abbrev=0 --tags`) && source ~/.nvm/nvm.sh
      && nvm install $TRAVIS_NODE_VERSION
    script:
    - cmake -DOPENSSL_LIBRARIES=/usr/local/opt/openssl/lib -DOPENSSL_INCLUDE_DIRS=/usr/local/opt/openssl/include/
      -DDEBUG=OFF . && make && cd www && npm install && npm run build_prod && cd ..
before_deploy:
- tar -C .. -czf micasa_${TRAVIS_OS_NAME}_${TARGET_ARCHITECTURE}.tgz micasa/micasa
  micasa/lib/open-zwave/config micasa/www/index.html micasa/www/index.appcache micasa/www/css
  micasa/www/fonts micasa/www/tpl micasa/www/app/app.min.js
- shasum -a 256 micasa_${TRAVIS_OS_NAME}_${TARGET_ARCHITECTURE}.tgz > micasa_${TRAVIS_OS_NAME}_${TARGET_ARCHITECTURE}.tgz.sha256sum
deploy:
  provider: releases
  skip_cleanup: true
  api_key:
    secure: hqOmsiArAsd5C7dJhruCOpMDk0ONqJ0oPb9j+JZBpeKbf825quVLii9cn0M5C/p2KZEeHLWpgFX4RgZubmOsp4cYxgRN5NXm2YvDQUD6HBKIZjcw7bdMXYA29Ek7RFRchUYq4TigjGsqe5Np7EPJbifLgC2kDUyIw+KX9xIMKqjqy1k4zj6LtC8gVbwKPT4I73p4whpo6vJxuE1TyXXzp35rZ9NT0te+DIdzMEDbUdvSwiio2aS0PzoVRS4ZAK9NplqGiO7DpDPIyG8H3JIGqi+bHZE9cJcvRY35BcJ/qPez2NhDJjSEs3gTbUwwM6xpHbFG2w8RT5pwgOfWmgwp3Pcl37TJxTqKQtMCus0P6UfB0StmOMvDvN7Wmb9/etu9akyp4Jg21dnE3wbGNYXFYlZVJOLAKquO29dxgy3PngV3TVIW3H4Kr52O5MOTqKQ8ZKeJtJl6JuuTO0IqsUKDJgbq+BG4K0lrCb1Qekqh0YlstLM8p3/AQ2AEDeqtb9bKVQaH9inKqzz0rIwk9+Si0oRaVikXb180pdG3e3OvzzjEHY3XLFd66xSfyjeAUK92Ye9FkjCRUEGETx+dEmU81/1bEAwEkw9elFIQZtpzYGhrPtS1Ua+HVFh5HB2jXFRtnmrKteo7hOjemtHRsEm6g++d2K6KWPzXo4VKLOCvGTA=
  file:
  - micasa_${TRAVIS_OS_NAME}_${TARGET_ARCHITECTURE}.tgz
  - micasa_${TRAVIS_OS_NAME}_${TARGET_ARCHITECTURE}.tgz.sha256sum
  on:
    repo: fellownet/micasa
    tags: true
