language: cpp
matrix:
  include:
  - os: linux
    env:
    - TARGET_ARCHITECTURE=x86_64
    - TRAVIS_NODE_VERSION="6"
    compiler:
    - gcc
    install:
    - rm -rf ~/.nvm && git clone https://github.com/creationix/nvm.git ~/.nvm && (cd
      ~/.nvm && git checkout `git describe --abbrev=0 --tags`) && source ~/.nvm/nvm.sh
      && nvm install $TRAVIS_NODE_VERSION
    addons:
      apt:
        packages:
        - cmake
        - libsqlite3-dev
        - curl
        - libcurl4-openssl-dev
        - libssl-dev
        - libavahi-client-dev
    script:
    - cmake -DDEBUG=OFF . && make && cd www && npm install && npm run build_prod &&
      cd ..
  - os: osx
    env:
    - TARGET_ARCHITECTURE=x86_64
    - TRAVIS_NODE_VERSION="6"
    compiler:
    - gcc
    install:
    - brew update
    - brew install libusb
    - brew install libusb-compat
    - brew install openssl
    - export OPENSSL_ROOT_DIR=/usr/local/opt/openssl
    - rm -rf ~/.nvm && git clone https://github.com/creationix/nvm.git ~/.nvm && (cd
      ~/.nvm && git checkout `git describe --abbrev=0 --tags`) && source ~/.nvm/nvm.sh
      && nvm install $TRAVIS_NODE_VERSION
    script:
    - cmake -DOPENSSL_LIBRARIES=/usr/local/opt/openssl/lib -DOPENSSL_INCLUDE_DIRS=/usr/local/opt/openssl/include/
      -DDEBUG=OFF . && make && cd www && npm install && npm run build_prod && cd ..
before_deploy:
- tar -C .. -czf micasa_${TRAVIS_OS_NAME}_${TARGET_ARCHITECTURE}.tgz micasa/micasa
  micasa/lib/open-zwave/config micasa/www/index.html micasa/www/index.appcache micasa/www/css
  micasa/www/fonts micasa/www/tpl micasa/www/app/app.min.js
- shasum -a 256 micasa_${TRAVIS_OS_NAME}_${TARGET_ARCHITECTURE}.tgz > micasa_${TRAVIS_OS_NAME}_${TARGET_ARCHITECTURE}.tgz.sha256sum
deploy:
  provider: releases
  api_key:
    secure: gNaeT2hGOYXoQxiB3+4jFyEpjwUBA9Q7+AvYP3rH2d5oWHPgUfebZYPU+7XjiZy6hBAmShSA6InVX+4i1NBMGGvdWfvL6kO6sG1eGCXa235GH4Z3Jd12n9nXPme4H88QbWw1SM3ntzvBFOCrZbIM1hjskJvSnuU6aSPlubEanFG8I12bD+bfK7e3DvZwujoqwENGXUVr6h7HDPh8yhqZxkZr1Pi7NdUNhoovSrTR79EbBMNjb3AI7s2vJ77Xh+Fgrh0UMYdEWPnu/Z+ZdQPV656rVzbO/jY25hcJ3mg9jvBrZxP4tFFLWPItDCSnrXFhMe7NzLIoaMH/NGkuxvZJpI9GLHdDdDPkIFScXORxU3StaLpzQFJhGoz4zkax5bK1uX8YMTFH9Za10Dd7Km9Ipw9RY4a8eV/dYBiZrOLvkfFpynZcFZb66VNctbbSksdQ1PZtrPBxW3QkvjROYgQEzMYjBpx9/t9EU4duy2Mb6GYMwyMKuZS0bd+JycfoOenVJt+a6FsYsxlsk+BgPSdyb95GsNqmq9386QQ8nxEuWDU4l6BhYPxpokG7xVeFKGMV8ZREoJJYzxXgmXvWHBsltNbYUBkX4Hh1oTPgrHY4cV/QTuiFShnYKBGXEACoe7awWy21RucsJuqiCObIm5Dh59TV2X7/Ihs7TlRfUAWI1y8=
  file:
  - micasa_${TRAVIS_OS_NAME}_${TARGET_ARCHITECTURE}.tgz
  - micasa_${TRAVIS_OS_NAME}_${TARGET_ARCHITECTURE}.tgz.sha256sum
  on:
    repo: fellownet/micasa
    tags: true
