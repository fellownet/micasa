language: cpp
matrix:
  include:
  - os: linux
    env:
    - TARGET_ARCHITECTURE=x86_64
    - TRAVIS_NODE_VERSION="6"
    compiler:
    - gcc
    install:
    - rm -rf ~/.nvm && git clone https://github.com/creationix/nvm.git ~/.nvm && (cd
      ~/.nvm && git checkout `git describe --abbrev=0 --tags`) && source ~/.nvm/nvm.sh
      && nvm install $TRAVIS_NODE_VERSION
    addons:
      apt:
        packages:
        - cmake
        - libsqlite3-dev
        - curl
        - libcurl4-openssl-dev
        - libssl-dev
        - libavahi-client-dev
    script:
    - cmake -DDEBUG=OFF . && make && cd www && npm install && npm run build_prod &&
      cd ..
  - os: osx
    env:
    - TARGET_ARCHITECTURE=x86_64
    - TRAVIS_NODE_VERSION="6"
    compiler:
    - gcc
    install:
    - brew update
    - brew install libusb
    - brew install libusb-compat
    - brew install openssl
    - export OPENSSL_ROOT_DIR=/usr/local/opt/openssl
    - rm -rf ~/.nvm && git clone https://github.com/creationix/nvm.git ~/.nvm && (cd
      ~/.nvm && git checkout `git describe --abbrev=0 --tags`) && source ~/.nvm/nvm.sh
      && nvm install $TRAVIS_NODE_VERSION
    script:
    - cmake -DOPENSSL_LIBRARIES=/usr/local/opt/openssl/lib -DOPENSSL_INCLUDE_DIRS=/usr/local/opt/openssl/include/
      -DDEBUG=OFF . && make && cd www && npm install && npm run build_prod && cd ..
before_deploy:
- tar -C .. -czf micasa_${TRAVIS_OS_NAME}_${TARGET_ARCHITECTURE}.tgz micasa/micasa
  micasa/lib/open-zwave/config micasa/www/index.html micasa/www/index.appcache micasa/www/css
  micasa/www/fonts micasa/www/tpl micasa/www/app/app.min.js
- shasum -a 256 micasa_${TRAVIS_OS_NAME}_${TARGET_ARCHITECTURE}.tgz > micasa_${TRAVIS_OS_NAME}_${TARGET_ARCHITECTURE}.tgz.sha256sum
deploy:
  provider: releases
  skip_cleanup: true
  api_key:
    secure: weKgmOkKAva2BkI6NaMI13mWAikHk+s1r6fr3wmwCZG1L+EenQGz2JHiL+veBxj+raLF5l71+AV3myuDs1NgwuY4fWe6AVTCpXAWlx5eLmBv6BgvOI57io2n5jUMDriJA+PSwJJ1yPZBzkQXadvMBaUVYs/pfs9Lc1lHM/+GMAdCWt4waI5fpEWsidN2T40JRETUYFRJxHMOTuLKxgaMNHcnNfkY0YCXyFUSCYTAhAjbflBLnmQbwENzAmG3qZgRvO7rYuV1idocmFz9nK1ZltLpM851tPevPIy/LUO2DXPkEpoKeVgnqC4YnxyZkgq9IBVP9e70gPvr2K+Baw7oHi52bLA2sCiiIwGSGM/Zd0NLPS3bT0fRgcmLAqZyIHWFD6jotJGWWmxQRv47huWePjdcQ38R6j8HyQUOM28fLXhlstdYfc6B2Mgy5dMvOSdJkIavvzLLlsBwdJ4IXfrakby4GdnJbnhyjSlw7xjgFWe2s0xY9ts1onhaXudIySCqRi082EUSBOgUHPrw3Dri+VwWLrLjtS7+D9EUOzrFjIGtS147BOl/aKq339MtXMnbUaT7WlVWtANXWhAvlmdZfjSeNKjzrtnPZPfOxEEN0JvBLebOLLfOFYuJTof+yr4XVHA6Cjt1ish6Zw581BTppRYbzTjbHAJIF1ukQx47xaM=
  file:
  - micasa_${TRAVIS_OS_NAME}_${TARGET_ARCHITECTURE}.tgz
  - micasa_${TRAVIS_OS_NAME}_${TARGET_ARCHITECTURE}.tgz.sha256sum
  on:
    repo: fellownet/micasa
    tags: true
